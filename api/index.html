<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  
  <link rel="shortcut icon" href="../img/favicon.ico">
  <title>API - librime-lua</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700" />

  <link rel="stylesheet" href="../css/theme.css" />
  <link rel="stylesheet" href="../css/theme_extra.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css" />
  
  <script>
    // Current page data
    var mkdocs_page_name = "API";
    var mkdocs_page_input_path = "api.md";
    var mkdocs_page_url = null;
  </script>
  
  <script src="../js/jquery-2.1.1.min.js" defer></script>
  <script src="../js/modernizr-2.8.3.min.js" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/bash.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/c++.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/lua.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
        <a href=".." class="icon icon-home"> librime-lua</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="..">Home</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../usage/">Usage</a>
                    </li>
                </ul>
                <ul class="current">
                    <li class="toctree-l1 current"><a class="reference internal current" href="./">API</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#example">Example</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#init">init</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#func">func</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#fini">fini</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#librime-lua-built-in-component">librime-lua built-in component</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#dictentry">DictEntry</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#functions">Functions</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#getters">Getters</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#setters">Setters</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#code">Code</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#functions_1">Functions</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#methods">Methods</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#commitentry">CommitEntry</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#methods_1">Methods</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#memory">Memory</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#introduction">Introduction</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#functions_2">Functions</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#methods_2">Methods</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#segment">Segment</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#functions_3">Functions</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#methods_3">Methods</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#getters_1">Getters</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#setters_1">Setters</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#candidate">Candidate</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#functions_4">Functions</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#methods_4">Methods</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#getters_2">Getters</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#setters_2">Setters</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#translation">Translation</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#functions_5">Functions</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#methods_5">Methods</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#reversedb">ReverseDb</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#functions_6">Functions</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#methods_6">Methods</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#segmentation">Segmentation</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#methods_7">Methods</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#getters_3">Getters</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#setters_3">Setters</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#menu">Menu</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#functions_7">Functions</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#keyevent">KeyEvent</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#methods_8">Methods</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#getters_4">Getters</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#engine">Engine</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#methods_9">Methods</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#getters_5">Getters</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#setters_4">Setters</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#context">Context</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#methods_10">Methods</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#getters_6">Getters</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#setters_5">Setters</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#preedit">Preedit</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#getters_7">Getters</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#setters_6">Setters</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#composition">Composition</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#methods_11">Methods</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#schema">Schema</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#functions_8">Functions</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#getters_8">Getters</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#setters_7">Setters</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#config">Config</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#methods_12">Methods</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#connection">Connection</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#methods_13">Methods</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#notifier">Notifier</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#methods_14">Methods</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#optionupdatenotifier">OptionUpdateNotifier</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#methods_15">Methods</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#propertyupdatenotifier">PropertyUpdateNotifier</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#methods_16">Methods</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#keyeventnotifer">KeyEventNotifer</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#methods_17">Methods</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#log">Log</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#functions_9">Functions</a>
    </li>
        </ul>
    </li>
        </ul>
    </li>
    </ul>
                    </li>
                </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="..">librime-lua</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="..">Docs</a> &raquo;</li>
    
      
    
    <li>API</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="module">Module</h1>
<blockquote>
<p>All librime-lua module should export as a table like <code>{init=function, func=function, fini=function}</code></p>
</blockquote>
<p><strong>Tips:</strong> <em>in this document parameters were presented as <code>function(parameter : type)</code> or <code>function(type)</code></em>
<em>function() : type represented return type</em>
<em>Pasted code is code of C++ source I don't understand</em></p>
<blockquote>
<p>You can call Functions of Component globally like <code>Functions()</code></p>
<p>Call Methods of Component like <code>ComponentObject:method()</code></p>
<p>Getters means properties can be accessed like <code>Component.property</code></p>
<p>Setters means properties can be access like <code>Component.property = value</code></p>
</blockquote>
<h2 id="example">Example</h2>
<p><strong>example.schema.yaml</strong></p>
<pre><code class="YAML">engine: # binding lua_function to rime components
  translators:
    - lua_translator@lua_tran   # lua_tran.func(input,Segment,env)
  filters:
    - lua_filter@lua_filt # lua_filt.func(input)
  processor:
    - lua_processor@lua_proc # lua_proc.func(KeyEvent,env)
</code></pre>

<p><strong>rime.lua</strong></p>
<pre><code class="lua">lua_tran = require(&quot;aTranslator&quot;)
lua_filt = require(&quot;aFilter&quot;)
lua_proc = require(&quot;aProcessor&quot;)
</code></pre>

<p><strong>aTranslator.lua</strong></p>
<pre><code class="lua">
local function main(input,segment,env)
    print(env.hello)
    -- helloRime
end

local function destory()
    print(&quot;Destroied!&quot;)
end

local function prepare(env)
    env.hello = &quot;helloRime&quot;
end

return {init = prepare,func = main,fini = destory}
</code></pre>

<p><strong>aFilter.lua</strong></p>
<pre><code class="lua">local function filter(input)
   local l = {}
   for cand in input:iter() do
      if (utf8.len(cand.text) == 1) then
     yield(cand)
      else
     table.insert(l, cand)
      end
   end
   for i, cand in ipairs(l) do
      yield(cand)
   end
end

return filter
-- or 
-- return {init = nil,func = filter, fini = nil}
</code></pre>

<p><strong>aProcessor</strong></p>
<pre><code>local function filter(key,env)
    print(key.keycode)
end

local function init(env)
    print(env.engine.schema.schema_id)
end

return {init = init, func = filter, fini = nil}
</code></pre>

<h2 id="init">init</h2>
<blockquote>
<p><code>init(env)</code> would be called when Initializing. </p>
<p><code>env</code> is the global variable of librime-Lua containing the librime environment, which has the following properties.</p>
<p><code>env.engine</code> type of <em>engine</em> and <code>env.name_space</code> type of <em>string</em></p>
<p>You could bind variables to env and use it in your module.</p>
</blockquote>
<pre><code class="lua">-- in test.lua

function ModuleInit(env)
    env.memory = Memory(env.engine,env.engine.schema)
    env.pyrdb = ReverseDb(&quot;build/terra_pinyin.reverse.bin&quot;)
end

return {init = ModuleInit}
</code></pre>

<h2 id="func">func</h2>
<blockquote>
<p><code>func</code> would be called when rime is attempting to call the module.</p>
<p>Which parameters would be passed depending on which rime component bind with the Lua module.</p>
<p>If Module bind with Translator. <code>func(input, Segment, env)</code> Would be called by <code>Translator::Query</code>. tips: <code>input</code> is type of <code>string</code></p>
<p>If Module bind with Filter. <code>func(Translation, env)</code> would be called <code>Filter::apply</code></p>
<p>If Module bind with Processor. <code>func(KeyEvent, env)</code> would be called by <code>Processor::ProcessKeyEvent</code></p>
</blockquote>
<h2 id="fini">fini</h2>
<blockquote>
<p>When LuaTranslator, LuaFilter, LuaProcess being destoried <code>fini</code> would be called </p>
</blockquote>
<h2 id="librime-lua-built-in-component">librime-lua built-in component</h2>
<h3 id="dictentry">DictEntry</h3>
<blockquote>
<h4 id="functions">Functions</h4>
<blockquote>
<h5 id="dictentry-dictentry">DictEntry() : DictEntry</h5>
<blockquote>
<p>Instance a empty <code>DictEntry</code></p>
</blockquote>
</blockquote>
<h4 id="getters">Getters</h4>
<blockquote>
<h5 id="text-string">text : string</h5>
<h5 id="comment-string">comment : string</h5>
<h5 id="preedit-string">preedit : string</h5>
<h5 id="weight-number">weight : number</h5>
<h5 id="commit_count-number">commit_count : number</h5>
<h5 id="custom_code-string">custom_code : string</h5>
<h5 id="remaining_code_length-number">remaining_code_length : number</h5>
<h5 id="code-code">code : Code</h5>
</blockquote>
<h4 id="setters">Setters</h4>
<blockquote>
<h5 id="text-string_1">text : string</h5>
<h5 id="comment-string_1">comment : string</h5>
<h5 id="preedit-string_1">preedit : string</h5>
<h5 id="weight-number_1">weight : number</h5>
<h5 id="commit_count-number_1">commit_count : number</h5>
<h5 id="custom_code-string_1">custom_code : string</h5>
<h5 id="remaining_code_length-number_1">remaining_code_length : number</h5>
<h5 id="code-code_1">code : Code</h5>
</blockquote>
</blockquote>
<h3 id="code">Code</h3>
<blockquote>
<h4 id="functions_1">Functions</h4>
<blockquote>
<h5 id="code_1">Code()</h5>
<blockquote>
<p>Create Empty <code>Code</code></p>
</blockquote>
</blockquote>
<h4 id="methods">Methods</h4>
<blockquote>
<h5 id="pushcode-number">push(code : number)</h5>
<blockquote>
<p>push code to <code>Code</code></p>
</blockquote>
<h5 id="print">print()</h5>
<blockquote>
<p>print current code</p>
</blockquote>
</blockquote>
</blockquote>
<h3 id="commitentry">CommitEntry</h3>
<blockquote>
<h4 id="methods_1">Methods</h4>
<blockquote>
<h5 id="get-dictentry">get() : {DictEntry}</h5>
<blockquote>
<p>Returns array of <code>DictEntry</code> in <code>CommitEntry</code></p>
</blockquote>
</blockquote>
</blockquote>
<h3 id="memory">Memory</h3>
<blockquote>
<h4 id="introduction">Introduction</h4>
<blockquote>
<p>A compoent that could access to <code>Dictionary</code> and <code>UserDictionary</code></p>
</blockquote>
<h4 id="functions_2">Functions</h4>
<blockquote>
<h5 id="memoryengine-schema-memory">Memory(Engine, Schema) : Memory</h5>
<blockquote>
<p>Returns the Instance of <em>Memory</em></p>
<p>Instance a <code>Memory</code> Object with given <code>Engine</code> and <code>Scehma</code></p>
</blockquote>
<h5 id="custommemoryengine-schema_id-namespacetranslator-memory">CustomMemory(Engine, schema_id="", namespace="translator") : Memory</h5>
<blockquote>
<p>Returns the Instance of <em>Memory</em></p>
<p>Instance a <code>Memory</code> Object with given <code>Engine</code> (running Engine), a <code>scheme_id</code>, and <code>namespace</code></p>
<p><code>scheme_id</code> were defined on input method schema</p>
</blockquote>
</blockquote>
</blockquote>
<p><em>cangjie5.schema.yaml</em></p>
<pre><code class="yaml">schema:
  schema_id: cangjie5 # this one
  name: 倉頡五代
  version: &quot;1.1.test&quot;
</code></pre>

<blockquote>
<blockquote>
<blockquote>
<p><code>namespace</code> is used to collect yaml tag of <code>namespace/dictionary</code> <code>namespace/enable_user_dict</code> and <code>namespace/db_class</code> in schema.</p>
</blockquote>
</blockquote>
</blockquote>
<p><em>cangjie5.schema.yaml</em></p>
<pre><code class="yaml">translator:
  dictionary: cangjie5 #this one!
  # enable_user_dict: true #this one
  # db_class: tabledb #this one
  enable_charset_filter: true
  enable_sentence: true
  enable_encoder: true
  encode_commit_history: true
  max_phrase_length: 5
  preedit_format:
    - 'xform/^([a-z]*)$/$1\t（\U$1\E）/'
    - &quot;xlit|ABCDEFGHIJKLMNOPQRSTUVWXYZ|日月金木水火土竹戈十大中一弓人心手口尸廿山女田難卜符|&quot;
  comment_format:
    - &quot;xlit|abcdefghijklmnopqrstuvwxyz~|日月金木水火土竹戈十大中一弓人心手口尸廿山女田難卜符～|&quot;
  disable_user_dict_for_patterns:
    - &quot;^z.*$&quot;
    - &quot;^yyy.*$&quot;
</code></pre>

<blockquote>
<h4 id="methods_2">Methods</h4>
<blockquote>
<h5 id="dictlookupinput-string-isexpand-boolean-boolean">dictLookup(input : string, isExpand : boolean) : boolean</h5>
<blockquote>
<p>Returns <em>true</em> if Lookup success.</p>
<p>The results are stored in <code>DicionaryIterator</code> inside <code>Memory</code>.</p>
<p>If <code>isExpand</code> were true, it would expand your <code>input</code> as a prefix. For example, the input is "hq", all results with the prefix "hq" in code  would be output.</p>
</blockquote>
<h5 id="userlookupinput-string-isexpand-boolean-boolean">userLookup(input : string, isExpand : boolean) : boolean</h5>
<blockquote>
<p>Returns <em>true</em> if Lookup success.</p>
<p>The results are stored in <code>UserDicionaryIterator</code> inside <code>Memory</code>.</p>
<p>If <code>isExpand</code> were true, it would expand your <code>input</code> as a prefix. For example, the input is "hq", all results with the prefix "hq" in code  would be output.</p>
</blockquote>
<h5 id="iter_dict">iter_dict()</h5>
<blockquote>
<p>Returns a Lua Iterator Of <code>Dictionary</code> Lookup Results which iterates a dictEntry.</p>
</blockquote>
</blockquote>
</blockquote>
<pre><code class="lua">for entry in mem:iter_dict()
 do
 print(entry.text)
end
</code></pre>

<blockquote>
<blockquote>
<h5 id="iter_user">iter_user()</h5>
<blockquote>
<p>Returns a Lua Iterator Of <code>UserDictionary</code> Lookup Results which iterates a dictEntry.</p>
</blockquote>
</blockquote>
</blockquote>
<pre><code class="lua">for entry in mem:iter_user()
 do
 print(entry.text)
end
</code></pre>

<blockquote>
<blockquote>
<h5 id="memorizefunctioncommitentry">memorize(function(CommitEntry))</h5>
<blockquote>
<p>To bind a lua_Function to <code>Memory::memorize</code> The Function would be called after commit, passing <code>CommitEntry</code> (contains committed <code>dictEntry</code>) to it.</p>
<p>You could use CommitEntry to manage User_Dict</p>
</blockquote>
<h5 id="updateuserdictdictentry-commits-number-new_entry_prefix-string">updateUserdict(DictEntry, commits : number, new_entry_prefix : string)</h5>
<blockquote>
<p>Update <code>UserDictionary</code> with specific <code>DictEntry</code></p>
<p>If <code>commits</code> &lt; 0 this entry would be marked as deleted.</p>
<p>If <code>commits</code> &gt; 0 then increasing the frequency of this entry committed.</p>
<p><code>new_entry_prefix</code> would become the code prefix of this entry  </p>
</blockquote>
</blockquote>
</blockquote>
<h3 id="segment">Segment</h3>
<blockquote>
<h4 id="functions_3">Functions</h4>
<blockquote>
<h5 id="segmentstart_pos-number-end_pos-number-segment">Segment(start_pos : number, end_pos : number) : Segment</h5>
<blockquote>
<p>Returns Instance of Segment</p>
</blockquote>
</blockquote>
<h4 id="methods_3">Methods</h4>
<blockquote>
<h5 id="clear">clear()</h5>
<blockquote>
<p>clean tags, reset menu,set Selected_index to 0,Clear prompt</p>
</blockquote>
<h5 id="close">close()</h5>
<blockquote>
<p>auto select Candidate then split into selected segment and  unselcted segment</p>
</blockquote>
<h5 id="reopencaret_pos-number">reopen(caret_pos : number)</h5>
</blockquote>
</blockquote>
<pre><code class="C++">bool Segment::Reopen(size_t caret_pos) {
  if (status &lt; kSelected) {
    return false;
  }
  const size_t original_end_pos = start + length;
  if (original_end_pos == caret_pos) {
    // reuse previous candidates and keep selection
    if (end &lt; original_end_pos) {
      // restore partial-selected segment
      end = original_end_pos;
      tags.erase(kPartialSelectionTag);
    }
    status = kGuess;
  }
  else {
    status = kVoid;
  }
  return true;
}
</code></pre>

<blockquote>
<blockquote>
<h5 id="has_tagtag-string-boolean">has_tag(tag : string) : boolean</h5>
<blockquote>
<p>Returns <em>if</em> the tag has been found.</p>
</blockquote>
<h5 id="get_candidate_atindex-number-number">get_candidate_at(index : number) : number</h5>
<blockquote>
<p>Returns <code>Candidate</code> of specific index.</p>
</blockquote>
<h5 id="get_selected_candidate-candidate">get_selected_candidate() : Candidate</h5>
<blockquote>
<p>Returns <code>Candidte</code> of selected candidte.</p>
</blockquote>
</blockquote>
<h4 id="getters_1">Getters</h4>
<blockquote>
<h5 id="status-string">status : string</h5>
<blockquote>
<p>Returns <code>"kVoid"</code> <code>"kVGuess"</code> <code>"kselected"</code> or <code>"kConfirmed"</code></p>
</blockquote>
<h5 id="start-number">start : number</h5>
<h5 id="_end-number">_end : number</h5>
<h5 id="length-number">length : number</h5>
<blockquote>
<p>Returns Segment's length</p>
</blockquote>
<h5 id="tags-table">tags : table</h5>
<blockquote>
<p>Returns a set of tags</p>
</blockquote>
<h5 id="menu-menu">menu : Menu</h5>
<h5 id="selected_index-number">selected_index : number</h5>
<h5 id="prompt-string">prompt : string</h5>
</blockquote>
<h4 id="setters_1">Setters</h4>
<blockquote>
<h5 id="status-string_1">status : string</h5>
<h5 id="start-number_1">start : number</h5>
<h5 id="_end-number_1">_end : number</h5>
<h5 id="length-number_1">length : number</h5>
<h5 id="tags-table_1">tags : table</h5>
<h5 id="menu-menu_1">menu : Menu</h5>
<h5 id="selected_index-number_1">selected_index : number</h5>
<h5 id="prompt-string_1">prompt : string</h5>
</blockquote>
</blockquote>
<h3 id="candidate">Candidate</h3>
<blockquote>
<h4 id="functions_4">Functions</h4>
<blockquote>
<h5 id="candidatetype-string-start-number-end-number-text-string-comment-string-candidate">Candidate(type : string, start : number, end: number, text : string, comment : string) : Candidate</h5>
<blockquote>
<p>Returns Instance of <code>Candidate</code></p>
</blockquote>
</blockquote>
<h4 id="methods_4">Methods</h4>
<blockquote>
<h5 id="get_dynamic_type-string">get_dynamic_type() : string</h5>
</blockquote>
</blockquote>
<pre><code class="c++">string dynamic_type(T &amp;c) {
  if (dynamic_cast&lt;Phrase *&gt;(&amp;c))
    return &quot;Phrase&quot;;
  if (dynamic_cast&lt;SimpleCandidate *&gt;(&amp;c))
    return &quot;Simple&quot;;
  if (dynamic_cast&lt;ShadowCandidate *&gt;(&amp;c))
    return &quot;Shadow&quot;;
  if (dynamic_cast&lt;UniquifiedCandidate *&gt;(&amp;c))
    return &quot;Uniquified&quot;;
  return &quot;Other&quot;;
}
</code></pre>

<blockquote>
<blockquote>
<h5 id="get_genuinecandidate-candidate">get_genuine(Candidate) : Candidate</h5>
</blockquote>
</blockquote>
<pre><code class="c++">an&lt;Candidate&gt;
Candidate::GetGenuineCandidate(const an&lt;Candidate&gt;&amp; cand) {
  auto uniquified = As&lt;UniquifiedCandidate&gt;(cand);
  return UnpackShadowCandidate(uniquified ? uniquified-&gt;items().front() : cand);
}
</code></pre>

<blockquote>
<blockquote>
<h5 id="get_genuinescandidate-candidate">get_genuines(Candidate) : Candidate</h5>
</blockquote>
</blockquote>
<pre><code class="c++">vector&lt;of&lt;Candidate&gt;&gt;
Candidate::GetGenuineCandidates(const an&lt;Candidate&gt;&amp; cand) {
  vector&lt;of&lt;Candidate&gt;&gt; result;
  if (auto uniquified = As&lt;UniquifiedCandidate&gt;(cand)) {
    for (const auto&amp; item : uniquified-&gt;items()) {
      result.push_back(UnpackShadowCandidate(item));
    }
  }
  else {
    result.push_back(UnpackShadowCandidate(cand));
  }
  return result;
}
</code></pre>

<blockquote>
<h4 id="getters_2">Getters</h4>
<blockquote>
<h5 id="type-string">type : string</h5>
<h5 id="start-number_2">start : number</h5>
<h5 id="_end-number_2">_end : number</h5>
<h5 id="quality-number">quality : number</h5>
<h5 id="text-string_2">text : string</h5>
<h5 id="comment-string_2">comment : string</h5>
<h5 id="preedit-string_2">preedit : string</h5>
</blockquote>
<h4 id="setters_2">Setters</h4>
<blockquote>
<h5 id="type-string_1">type : string</h5>
<h5 id="start-number_3">start : number</h5>
<h5 id="_end-number_3">_end : number</h5>
<h5 id="quality-number_1">quality : number</h5>
<h5 id="text-string_3">text : string</h5>
<h5 id="comment-string_3">comment : string</h5>
<h5 id="preedit-string_3">preedit : string</h5>
</blockquote>
</blockquote>
<h3 id="translation">Translation</h3>
<blockquote>
<h4 id="functions_5">Functions</h4>
<blockquote>
<h5 id="translationinitfunction-function">Translation(initFunction : function)</h5>
<blockquote>
<p>Returns Instance of <code>Translation</code>,and call the initFunction.</p>
</blockquote>
</blockquote>
<h4 id="methods_5">Methods</h4>
<blockquote>
<h5 id="iter">iter()</h5>
<blockquote>
<p>Returns lua iterator for <code>Translation</code> that iterate <code>Candidate</code></p>
</blockquote>
</blockquote>
</blockquote>
<pre><code class="lua">for can in translation:iter()
do 
  print(can.text)
end
</code></pre>

<h3 id="reversedb">ReverseDb</h3>
<blockquote>
<h4 id="functions_6">Functions</h4>
<blockquote>
<h5 id="reversedbreversedb_file_name-string-reversedb">ReverseDb(ReverseDb_File_Name : string) : ReverseDb</h5>
<blockquote>
<p>Returns Instance of <code>ReverseDb</code></p>
</blockquote>
</blockquote>
<h4 id="methods_6">Methods</h4>
<blockquote>
<h5 id="lookupkey-string-string">lookup(key : string) : string</h5>
<blockquote>
<p>Returns <code>string</code> of reverseDb lookup result</p>
</blockquote>
</blockquote>
</blockquote>
<h3 id="segmentation">Segmentation</h3>
<blockquote>
<h4 id="methods_7">Methods</h4>
<blockquote>
<h5 id="empty-boolean">empty() : boolean</h5>
<h5 id="back-segment">back() : Segment</h5>
<blockquote>
<p>Returns last element of <code>Segmentation</code></p>
</blockquote>
<h5 id="pop_back">pop_back()</h5>
<blockquote>
<p>Delete the last element of <code>Segmentation</code> </p>
</blockquote>
<h5 id="reset_lengthlength-number">reset_length(length : number)</h5>
<blockquote>
<p>Reset <code>Segmentation</code> with given length </p>
</blockquote>
<h5 id="add_segmentsegment">add_segment(Segment)</h5>
<blockquote>
<p>Add given <code>Segment</code> at <code>Segmentation</code>'s end</p>
</blockquote>
<h5 id="forward">forward()</h5>
</blockquote>
</blockquote>
<pre><code class="C++">// finalize a round
bool Segmentation::Forward() {
  if (empty() || back().start == back().end)
    return false;
  // initialize an empty segment for the next round
  push_back(Segment(back().end, back().end));
  return true;
}
</code></pre>

<blockquote>
<blockquote>
<h5 id="trim">trim()</h5>
</blockquote>
</blockquote>
<pre><code class="c++">// remove empty trailing segment
bool Segmentation::Trim() {
  if (!empty() &amp;&amp; back().start == back().end) {
    pop_back();
    return true;
  }
  return false;
}
</code></pre>

<blockquote>
<blockquote>
<h5 id="has_finished_segmentation">has_finished_segmentation()</h5>
</blockquote>
</blockquote>
<pre><code class="C++">bool Segmentation::HasFinishedSegmentation() const {
  return (empty() ? 0 : back().end) &gt;= input_.length();
}
</code></pre>

<blockquote>
<blockquote>
<h5 id="get_current_start_position-number">get_current_start_position() : number</h5>
</blockquote>
</blockquote>
<pre><code class="c++">size_t Segmentation::GetCurrentStartPosition() const {
  return empty() ? 0 : back().start;
}
</code></pre>

<blockquote>
<blockquote>
<h5 id="get_current_end_position-number">get_current_end_position() : number</h5>
</blockquote>
</blockquote>
<pre><code class="C++">size_t Segmentation::GetCurrentEndPosition() const {
  return empty() ? 0 : back().end;
}

</code></pre>

<blockquote>
<blockquote>
<h5 id="get_current_segment_length-number">get_current_segment_length : number</h5>
</blockquote>
</blockquote>
<pre><code class="c++">size_t Segmentation::GetCurrentSegmentLength() const {
  return empty() ? 0 : (back().end - back().start);
}
</code></pre>

<blockquote>
<blockquote>
<h5 id="get_confirmed_position-number">get_confirmed_position : number</h5>
</blockquote>
</blockquote>
<pre><code class="c++">size_t Segmentation::GetConfirmedPosition() const {
  size_t k = 0;
  for (const Segment&amp; seg : *this) {
    if (seg.status &gt;= Segment::kSelected)
      k = seg.end;
  }
  return k;
}
</code></pre>

<blockquote>
<h4 id="getters_3">Getters</h4>
<blockquote>
<h5 id="input-string">input : string</h5>
</blockquote>
<h4 id="setters_3">Setters</h4>
<blockquote>
<h5 id="input-string_1">input : string</h5>
</blockquote>
</blockquote>
<h3 id="menu">Menu</h3>
<blockquote>
<h4 id="functions_7">Functions</h4>
<blockquote>
<h5 id="add_translationtranslation">add_translation(Translation)</h5>
<h5 id="preparerequested-number-number">prepare(requested : number) : number</h5>
</blockquote>
</blockquote>
<pre><code class="C++">size_t Menu::Prepare(size_t requested) {
  DLOG(INFO) &lt;&lt; &quot;preparing &quot; &lt;&lt; requested &lt;&lt; &quot; candidates.&quot;;
  while (candidates_.size() &lt; requested &amp;&amp; !result_-&gt;exhausted()) {
    if (auto cand = result_-&gt;Peek()) {
      candidates_.push_back(cand);
    }
    result_-&gt;Next();
  }
  return candidates_.size();
}
</code></pre>

<blockquote>
<blockquote>
<h5 id="get_candidate_atindex-number-candidate">get_candidate_at(index : number) : Candidate</h5>
<h5 id="candidate_count-number">candidate_count() : number</h5>
<h5 id="empty-boolean_1">empty() : boolean</h5>
</blockquote>
</blockquote>
<h3 id="keyevent">KeyEvent</h3>
<blockquote>
<h4 id="methods_8">Methods</h4>
<blockquote>
<h5 id="shift-boolean">shift : boolean</h5>
<h5 id="ctrl-boolean">ctrl : boolean</h5>
<h5 id="alt-boolean">alt : boolean</h5>
<h5 id="caps-boolean">caps : boolean</h5>
<h5 id="super-boolean">super : boolean</h5>
<h5 id="release-boolean">release : boolean</h5>
<h5 id="repr-string">repr : string</h5>
<h5 id="eq-boolean">eq ： boolean</h5>
<blockquote>
<p>Returns is euqual to other <code>KeyEvent</code></p>
</blockquote>
<h5 id="lt-boolean">lt : boolean</h5>
<blockquote>
<p>Returns is less than other <code>KeyEvent</code></p>
</blockquote>
</blockquote>
<h4 id="getters_4">Getters</h4>
<blockquote>
<h5 id="keycode-number">keycode : number</h5>
<h5 id="modifier-number">modifier : number</h5>
</blockquote>
</blockquote>
<h3 id="engine">Engine</h3>
<blockquote>
<h4 id="methods_9">Methods</h4>
<blockquote>
<h5 id="commit_texttext-string">commit_text(text : string)</h5>
<blockquote>
<p>commit given text</p>
</blockquote>
</blockquote>
<h4 id="getters_5">Getters</h4>
<blockquote>
<h5 id="schema-schema">schema : Schema</h5>
<blockquote>
<p>returns current <code>Schema</code></p>
</blockquote>
<h5 id="context-context">context : Context</h5>
<blockquote>
<p>returns current <code>Context</code></p>
</blockquote>
<h5 id="active_engine-engine">active_engine : Engine</h5>
</blockquote>
<h4 id="setters_4">Setters</h4>
<blockquote>
<h5 id="active_engineengine">active_engine(Engine)</h5>
</blockquote>
</blockquote>
<h3 id="context">Context</h3>
<blockquote>
<h4 id="methods_10">Methods</h4>
<blockquote>
<h5 id="commit-boolean">commit() : boolean</h5>
<h5 id="get_commit_text-string">get_commit_text() : string</h5>
<h5 id="get_script_text-string">get_script_text() : string</h5>
<h5 id="get_preedit-string">get_preedit() : string</h5>
<h5 id="is_composing-boolean">is_composing() : boolean</h5>
<h5 id="has_menu-boolean">has_menu() : boolean</h5>
<h5 id="get_selected_candidate-candidate_1">get_selected_candidate() : Candidate</h5>
<h5 id="push_inputinput-string-boolean">push_input(input : string) : boolean</h5>
<h5 id="pop_inputlen-number-boolean">pop_input(len : number) : boolean</h5>
<blockquote>
<p>delete input of given amount</p>
</blockquote>
</blockquote>
</blockquote>
<pre><code class="C++">bool Context::PopInput(size_t len) {
  if (caret_pos_ &lt; len)
    return false;
  caret_pos_ -= len;  // differ to DeleteInput
  input_.erase(caret_pos_, len);
  update_notifier_(this);
  return true;
}
</code></pre>

<blockquote>
<blockquote>
<h5 id="delete_inputlen-number-boolean">delete_input(len : number) : boolean</h5>
<blockquote>
<p>delete input of given amount</p>
</blockquote>
</blockquote>
</blockquote>
<pre><code class="C++">bool Context::DeleteInput(size_t len) {
  if (caret_pos_ + len &gt; input_.length())
    return false;
  input_.erase(caret_pos_, len);
  update_notifier_(this);
  return true;
}

</code></pre>

<blockquote>
<blockquote>
<h5 id="clear_1">clear()</h5>
<h5 id="selectindex-number-boolean">select(index : number) : boolean</h5>
<h5 id="confirm_current_selection-boolean">confirm_current_selection() : boolean</h5>
<h5 id="delete_current_selection-boolean">delete_current_selection() : boolean</h5>
<h5 id="confirm_previous_selection-boolean">confirm_previous_selection() : boolean</h5>
<h5 id="reopen_previous_selection-boolean">reopen_previous_selection() : boolean</h5>
<h5 id="clear_previous_segment-boolean">clear_previous_segment() : boolean</h5>
<h5 id="reopen_previous_segment-boolean">reopen_previous_segment() : boolean</h5>
<h5 id="clear_non_confirmed_composition-boolean">clear_non_confirmed_composition() : boolean</h5>
<h5 id="refresh_non_confirmed_composition-boolean">refresh_non_confirmed_composition() : boolean</h5>
<h5 id="set_optionname-string-value-boolean">set_option(name : string, value : boolean)</h5>
<h5 id="get_optionname-string">get_option(name : string)</h5>
<h5 id="set_propertyname-stringvalue-string">set_property(name : string,value : string)</h5>
<h5 id="get_propertyname-string-string">get_property(name : string) : string</h5>
<h5 id="clear_transient_options">clear_transient_options()</h5>
</blockquote>
</blockquote>
<pre><code class="c++">void Context::ClearTransientOptions() {
  auto opt = options_.lower_bound(&quot;_&quot;);
  while (opt != options_.end() &amp;&amp;
         !opt-&gt;first.empty() &amp;&amp; opt-&gt;first[0] == '_') {
    options_.erase(opt++);
  }
  auto prop = properties_.lower_bound(&quot;_&quot;);
  while (prop != properties_.end() &amp;&amp;
         !prop-&gt;first.empty() &amp;&amp; prop-&gt;first[0] == '_') {
    properties_.erase(prop++);
  }
}
</code></pre>

<blockquote>
<h4 id="getters_6">Getters</h4>
<blockquote>
<h5 id="composition-composition">composition : Composition</h5>
<h5 id="input-string_2">input : string</h5>
<h5 id="caret_pos-number">caret_pos : number</h5>
<h5 id="commit_notifier-notifier">commit_notifier : Notifier</h5>
<h5 id="select_notifier-notifier">select_notifier : Notifier</h5>
<h5 id="update_notifier-notifier">update_notifier : Notifier</h5>
<h5 id="delete_notifier-notifier">delete_notifier : Notifier</h5>
<h5 id="option_update_notifier-notifier">option_update_notifier : Notifier</h5>
<h5 id="property_update_notifier-notifier">property_update_notifier : Notifier</h5>
<h5 id="unhandled_key_notifier-notifier">unhandled_key_notifier : Notifier</h5>
</blockquote>
<h4 id="setters_5">Setters</h4>
<blockquote>
<h5 id="composition-composition_1">composition : Composition</h5>
<h5 id="input-string_3">input : string</h5>
<h5 id="caret_pos-number_1">caret_pos : number</h5>
</blockquote>
</blockquote>
<h3 id="preedit">Preedit</h3>
<blockquote>
<h4 id="getters_7">Getters</h4>
<blockquote>
<h5 id="text-string_4">text : string</h5>
<h5 id="caret_pos-number_2">caret_pos : number</h5>
<h5 id="sel_start-number">sel_start : number</h5>
<h5 id="sel_end-number">sel_end : number</h5>
</blockquote>
<h4 id="setters_6">Setters</h4>
<blockquote>
<h5 id="text-string_5">text : string</h5>
<h5 id="caret_pos-number_3">caret_pos : number</h5>
<h5 id="sel_start-number_1">sel_start : number</h5>
<h5 id="sel_end-number_1">sel_end : number</h5>
</blockquote>
</blockquote>
<h3 id="composition">Composition</h3>
<blockquote>
<p>Extends <code>Segmentation</code></p>
<h4 id="methods_11">Methods</h4>
<blockquote>
<h5 id="empty-boolean_2">empty() : boolean</h5>
<h5 id="back-composition">back() : Composition</h5>
<h5 id="pop_back-bool">pop_back() : bool</h5>
<h5 id="push_backsegmentation">push_back(Segmentation)</h5>
<h5 id="has_finished_composition-bool">has_finished_composition() : bool</h5>
<h5 id="get_prompt-string">get_prompt() : string</h5>
</blockquote>
</blockquote>
<h3 id="schema">Schema</h3>
<blockquote>
<h4 id="functions_8">Functions</h4>
<blockquote>
<h5 id="schemaschema_id-string-schema">Schema(schema_id : string) : Schema</h5>
</blockquote>
<h4 id="getters_8">Getters</h4>
<blockquote>
<h5 id="schema_id-string">schema_id : string</h5>
<h5 id="schema_name-string">schema_name : string</h5>
<h5 id="config-config">config : Config</h5>
<h5 id="page_size-number">page_size : number</h5>
<h5 id="select_keys-string">select_keys : string</h5>
</blockquote>
<h4 id="setters_7">Setters</h4>
<blockquote>
<h5 id="config-config_1">config : Config</h5>
<h5 id="select_keys-string_1">select_keys : string</h5>
</blockquote>
</blockquote>
<h3 id="config">Config</h3>
<blockquote>
<h4 id="methods_12">Methods</h4>
<blockquote>
<h5 id="load_from_filefile_name-string-boolean">load_from_file(file_name : string) : boolean</h5>
<h5 id="save_to_filefile_name-string-boolean">save_to_file(file_name : string) : boolean</h5>
<h5 id="is_nullpath-string-boolean">is_null(path : string) : boolean</h5>
<h5 id="is_valuepath-string-boolean">is_value(path : string) : boolean</h5>
<h5 id="is_listpath-string-boolean">is_list(path : string) : boolean</h5>
<h5 id="is_mappath-string-boolean">is_map(path : string) : boolean</h5>
<h5 id="get_boolpath-string-boolean">get_bool(path : string) : boolean</h5>
<h5 id="get_intpath-string-number">get_int(path : string) : number</h5>
<h5 id="get_doublepath-string-number">get_double(path : string) : number</h5>
<h5 id="get_stringpath-string-string">get_string(path : string) : string</h5>
<h5 id="get_list_sizepath-string-number">get_list_size(path : string) : number</h5>
<h5 id="set_boolpath-string-value-bool-bool">set_bool(path : string, value : bool) : bool</h5>
<h5 id="set_intpath-string-value-number-boolean">set_int(path : string, value : number) : boolean</h5>
<h5 id="set_doublepath-string-value-number-boolean">set_double(path : string, value : number) : boolean</h5>
<h5 id="set_stringpath-string-value-string-boolean">set_string(path : string, value : string) : boolean</h5>
</blockquote>
</blockquote>
<h3 id="connection">Connection</h3>
<blockquote>
<h4 id="methods_13">Methods</h4>
<blockquote>
<h5 id="disconnect">disconnect()</h5>
</blockquote>
</blockquote>
<h3 id="notifier">Notifier</h3>
<blockquote>
<h4 id="methods_14">Methods</h4>
<blockquote>
<h5 id="connectnotifier-context-connection">connect(Notifier, Context) : Connection</h5>
</blockquote>
</blockquote>
<h3 id="optionupdatenotifier">OptionUpdateNotifier</h3>
<blockquote>
<h4 id="methods_15">Methods</h4>
<blockquote>
<h5 id="connectoptionupdatenotifier-string-connection">connect(OptionUpdateNotifier, string): Connection</h5>
</blockquote>
</blockquote>
<h3 id="propertyupdatenotifier">PropertyUpdateNotifier</h3>
<blockquote>
<h4 id="methods_16">Methods</h4>
<blockquote>
<h5 id="connectpropertyupdatenotifier-string-connection">connect(PropertyUpdateNotifier, string): Connection</h5>
</blockquote>
</blockquote>
<h3 id="keyeventnotifer">KeyEventNotifer</h3>
<blockquote>
<h4 id="methods_17">Methods</h4>
<blockquote>
<h5 id="connectkeyeventnotifer-keyevent-connection">connect(KeyEventNotifer, KeyEvent) : Connection</h5>
</blockquote>
</blockquote>
<h3 id="log">Log</h3>
<blockquote>
<p>Use <code>Log</code> to logging your lua function.</p>
<h4 id="functions_9">Functions</h4>
<blockquote>
<h5 id="infostring">info(string)</h5>
<h5 id="warningstring">warning(string)</h5>
<h5 id="errorstring">error(string)</h5>
</blockquote>
</blockquote>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
      
        <a href="../usage/" class="btn btn-neutral" title="Usage"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
      
        <span><a href="../usage/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
    </span>
</div>
    <script>var base_url = '..';</script>
    <script src="../js/theme.js" defer></script>
      <script src="../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
